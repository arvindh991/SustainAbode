{% load static %}

<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="Sustain ABode - Your Path to a Greener Future">
        <meta name="author" content="Sustain ABode">
        <title>{% block title %}Sustain ABode{% endblock %}</title>
        <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
        <link rel="shortcut icon" href="{% static 'images/logo.svg' %}" sizes="128x128">
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
        <link rel="stylesheet" href="{% static 'css/styles.css' %}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    </head>

    <body>
        <header>
            <!-- section 1 for the landing page -->
            <nav class="navbar navbar-expand-md navbar-dark fixed-top" style="background-color: #2f5b4c;">
                <a class="navbar-brand" href="{% url 'landing_page' %}">
                    <img src="{% static 'images/knowledge-center-logo.svg' %}" alt="SustainABode Logo"
                        style="height: 120px; width: auto; margin-left: 20px;">Home</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
                    aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav ms-auto me-4">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'sustainscoremap' %}">SustainScore</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'comparesuburbsmap' %}">Compare</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'about' %}">About</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <main class="container-fluid" style="background-color: #2f5b4c;">
            {% block content %}{% endblock %}
        </main>

        <!-- Bootstrap core JavaScript -->
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

        <!-- Custom JavaScript to Handle Click-based Carousel Slide with Fade -->
        <script>
            document.querySelectorAll('.carousel-clickable').forEach(function (image) {
                image.addEventListener('click', function () {
                    jQuery('#carouselExampleIndicators').carousel('next'); // Trigger next slide on click
                });
            });

            const texts = [
                "Realizing the need to buy a house that aligns with their sustainable values and lifestyle.",
                "Starts looking for potential suburbs and shortlisting their priorities.",
                "Frustrated and overwhelmed that they can't find centralized data about all the indicators which makes them indecisive.",
                "Comes across SUSTAINABODE which not only helps them by providing centralized data regarding various indicators but also personalized insights to make informed decisions.",
                "Finds their happily ever after, thanks to SustainAbode."
            ];

            function typeText(elementId, text, delay = 50) {
                let i = 0;
                const element = document.getElementById(elementId);
                element.innerHTML = "";
                const interval = setInterval(() => {
                    element.innerHTML += text[i];
                    i++;
                    if (i === text.length) {
                        clearInterval(interval);
                    }
                }, delay);
            }

            // Trigger typing effect on active slide
            function triggerTypingEffect() {
                const activeSlide = document.querySelector('.carousel-item.active');
                const textId = activeSlide.querySelector('.typed-text').id;
                const index = Array.from(activeSlide.parentNode.children).indexOf(activeSlide);
                typeText(textId, texts[index]);
            }

            // Initialize typing effect on first load
            document.addEventListener('DOMContentLoaded', () => {
                triggerTypingEffect();
            });

            // Re-trigger typing effect on slide change
            $('#carouselExampleIndicators').on('slid.bs.carousel', function () {
                triggerTypingEffect();
            });

            window.addEventListener('scroll', function () {
                var scrolled = window.pageYOffset;
                var parallax = document.querySelector('.parallax-bg');
                parallax.style.transform = 'translateY(' + (scrolled * 0.3) + 'px)';
            });
            document.addEventListener('DOMContentLoaded', function () {
                var wrapper = document.querySelector(".wrapper");
                var pages = document.querySelectorAll(".page");
                var scrolling = false;
                var currentPage = 1;
                var navPanel = document.querySelector(".nav-panel");
                var scrollBtns = document.querySelectorAll(".scroll-btn");
                var navBtns = document.querySelectorAll(".nav-btn");

                function manageClasses() {
                    wrapper.className = "wrapper active-page" + currentPage;
                    navBtns.forEach(btn => btn.classList.remove("active"));
                    document.querySelector(".nav-page" + currentPage).classList.add("active");
                    scrolling = true;
                    setTimeout(function () {
                        scrolling = false;
                    }, 1000);
                }

                function navigateUp() {
                    if (currentPage > 1 && !scrolling) {
                        currentPage--;
                        manageClasses();
                    }
                }

                function navigateDown() {
                    if (currentPage < pages.length && !scrolling) {
                        currentPage++;
                        manageClasses();
                    }
                }

                scrollBtns.forEach(btn => {
                    btn.addEventListener("click", function () {
                        if (this.classList.contains("up")) {
                            navigateUp();
                        } else {
                            navigateDown();
                        }
                    });
                });

                navBtns.forEach(btn => {
                    btn.addEventListener("click", function () {
                        if (!scrolling) {
                            currentPage = parseInt(this.getAttribute("data-target"));
                            manageClasses();
                        }
                    });
                });

                document.addEventListener("wheel", function (e) {
                    if (!scrolling) {
                        if (e.deltaY < 0) {
                            navigateUp();
                        } else {
                            navigateDown();
                        }
                    }
                });
            });
        </script>
    
        <!-- Java script for text transition -->

        <script>
            window.addEventListener('scroll', function () {
                var textElement = document.getElementById('scrollText');
                var textPosition = textElement.getBoundingClientRect().top;
                var screenPosition = window.innerHeight / 1.3;  // Adjust to trigger the animation earlier or later

                if (textPosition < screenPosition) {
                    textElement.classList.add('visible');
                } else {
                    textElement.classList.remove('visible');
                }

                var textElement1 = document.getElementById('scrollText1');
                var textPosition1 = textElement.getBoundingClientRect().top;
                var screenPosition1 = window.innerHeight / 1.3;  // Adjust to trigger the animation earlier or later

                if (textPosition1 < screenPosition1) {
                    textElement1.classList.add('visible');
                } else {
                    textElement1.classList.remove('visible');
                }

                var textElement2 = document.getElementById('scrollText2');
                var textPosition2 = textElement.getBoundingClientRect().top;
                var screenPosition2 = window.innerHeight / 1.3;  // Adjust to trigger the animation earlier or later

                if (textPosition2 < screenPosition2) {
                    textElement2.classList.add('visible');
                } else {
                    textElement2.classList.remove('visible');
                }

                var textElement3 = document.getElementById('scrollText3');
                var textPosition3 = textElement.getBoundingClientRect().top;
                var screenPosition3 = window.innerHeight / 1.3;  // Adjust to trigger the animation earlier or later

                if (textPosition3 < screenPosition3) {
                    textElement3.classList.add('visible');
                } else {
                    textElement3.classList.remove('visible');
                }

                var imageElement = document.getElementById('scrollimage');
                var imagePosition = imageElement.getBoundingClientRect().top;
                var screenPosition1 = window.innerHeight / 1.3;  // Adjust to trigger the animation earlier or later

                if (imagePosition < screenPosition1) {
                    imageElement.classList.add('visible');
                } else {
                    imageElement.classList.remove('visible');
                }
            });
        </script>

        <!-- Java script for image transition -->
        <script>
            // Scroll-based animation
            document.addEventListener('DOMContentLoaded', function() {
                const images = document.querySelectorAll('.animated-img');

                // Function to check if an element is in the viewport
                function isInViewport(element) {
                    const rect = element.getBoundingClientRect();
                    return (
                        rect.top >= 0 &&
                        rect.left >= 0 &&
                        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
                    );
                }

                // Function to handle image appearance
                function checkImagesInView() {
                    images.forEach(image => {
                        if (isInViewport(image)) {
                            image.classList.add('img-visible'); // Add class to make the image visible
                        }
                    });
                }

                // Run the function on scroll
                window.addEventListener('scroll', checkImagesInView);

                // Run the function on initial load
                checkImagesInView();
            });
        </script>

        <!-- Java script for landing page graph -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!--  Internal JavaScript Section for graph -->
        <script>
            // Data for the top 5 suburbs in Melbourne
            const suburbData = {
                labels: ['Box-Hill', 'South Yarra', 'Richmond', 'Glen waverley', 'Tarneit'],
                datasets: [
                    {
                        label: 'School Ranking',
                        data: [88, 75, 70, 98, 80], // School ranking scores (out of 100)
                        backgroundColor: 'rgba(46, 139, 87, 0.6)', // SeaGreen
                        borderColor: 'rgba(46, 139, 87, 1)', // Solid SeaGreen border
                        borderWidth: 1,
                        hoverBackgroundColor: 'rgba(46, 139, 87, 0.8)', // Darker SeaGreen on hover
                        hoverBorderColor: 'rgba(46, 139, 87, 1)'
                    },
                    {
                        label: 'Crime Rate (lower is better)',
                        data: [10, 22, 40, 10, 35], // Crime rate (lower is better)
                        backgroundColor: 'rgba(178, 34, 34, 0.6)', // FireBrick for high contrast with green
                        borderColor: 'rgba(178, 34, 34, 1)', // Solid FireBrick border
                        borderWidth: 1,
                        hoverBackgroundColor: 'rgba(178, 34, 34, 0.8)',
                        hoverBorderColor: 'rgba(178, 34, 34, 1)'
                    },
                    {
                        label: 'Public Transport Accessibility',
                        data: [85, 85, 95, 90, 75], // Transport accessibility score (out of 100)
                        backgroundColor: 'rgba(32, 178, 170, 0.6)', // LightSeaGreen
                        borderColor: 'rgba(32, 178, 170, 1)', // Solid LightSeaGreen border
                        borderWidth: 1,
                        hoverBackgroundColor: 'rgba(32, 178, 170, 0.8)',
                        hoverBorderColor: 'rgba(32, 178, 170, 1)'
                    },
                    {
                        label: 'Housing Affordability',
                        data: [40, 75, 40, 40, 90], // Affordability score (out of 100, higher is better)
                        backgroundColor: 'rgba(189, 183, 107, 0.6)', // DarkKhaki for a soft green contrast
                        borderColor: 'rgba(189, 183, 107, 1)', // Solid DarkKhaki border
                        borderWidth: 1,
                        hoverBackgroundColor: 'rgba(189, 183, 107, 0.8)',
                        hoverBorderColor: 'rgba(189, 183, 107, 1)'
                    },
                    {
                        label: 'Green Spaces',
                        data: [60, 95, 60, 65, 85], // Green spaces score (out of 100)
                        backgroundColor: 'rgba(85, 107, 47, 0.6)', // DarkOliveGreen
                        borderColor: 'rgba(85, 107, 47, 1)', // Solid DarkOliveGreen border
                        borderWidth: 1,
                        hoverBackgroundColor: 'rgba(85, 107, 47, 0.8)',
                        hoverBorderColor: 'rgba(85, 107, 47, 1)'
                    }
                ]

            };

            // Configuration for the chart
            const config = {
                type: 'bar', // Bar chart type
                data: suburbData,
                options: {
                    responsive: true, // Ensure chart adjusts to container size
                    plugins: {
                        tooltip: {
                            callbacks: {
                                // Tooltip content customization
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.raw;
                                    return label + ' points';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true // Stack the bars for each category
                        },
                        y: {
                            beginAtZero: true, // Start y-axis at 0
                            title: {
                                display: true,
                                text: 'Score (0-100)' // Y-axis title
                            }
                        }
                    }
                }
            };

            // Render the chart in the canvas element
            const ctx = document.getElementById('suburbChart').getContext('2d');
            const suburbChart = new Chart(ctx, config);
        </script>

    </body>
</html>